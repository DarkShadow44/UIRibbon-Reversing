/* This file is generated - Do not edit manually */

#include "parser_uiribbon.h"

int stream_read_type_id(stream *s_root, stream *s, type_id *data, type_uiribbon *_root);
int stream_write_type_id(stream *s_root, stream *s, type_id *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_id(type_id *data);
int stream_read_type_string(stream *s_root, stream *s, type_string *data, type_uiribbon *_root);
int stream_write_type_string(stream *s_root, stream *s, type_string *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_string(type_string *data);
int stream_read_type_strings(stream *s_root, stream *s, type_strings *data, type_uiribbon *_root);
int stream_write_type_strings(stream *s_root, stream *s, type_strings *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_strings(type_strings *data);
int stream_read_type_resource_generic(stream *s_root, stream *s, type_resource_generic *data, type_uiribbon *_root);
int stream_write_type_resource_generic(stream *s_root, stream *s, type_resource_generic *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_resource_generic(type_resource_generic *data);
int stream_read_type_resource(stream *s_root, stream *s, type_resource *data, type_uiribbon *_root);
int stream_write_type_resource(stream *s_root, stream *s, type_resource *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_resource(type_resource *data);
int stream_read_type_sizedefinitions_order_command(stream *s_root, stream *s, type_sizedefinitions_order_command *data, type_uiribbon *_root);
int stream_write_type_sizedefinitions_order_command(stream *s_root, stream *s, type_sizedefinitions_order_command *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_sizedefinitions_order_command(type_sizedefinitions_order_command *data);
int stream_read_type_sizedefinition_order(stream *s_root, stream *s, type_sizedefinition_order *data, type_uiribbon *_root);
int stream_write_type_sizedefinition_order(stream *s_root, stream *s, type_sizedefinition_order *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_sizedefinition_order(type_sizedefinition_order *data);
int stream_read_type_tree_entry_number_variable(stream *s_root, stream *s, type_tree_entry_number_variable *data, type_uiribbon *_root);
int stream_write_type_tree_entry_number_variable(stream *s_root, stream *s, type_tree_entry_number_variable *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entry_number_variable(type_tree_entry_number_variable *data);
int stream_read_type_tree_entry_number_long(stream *s_root, stream *s, type_tree_entry_number_long *data, type_uiribbon *_root);
int stream_write_type_tree_entry_number_long(stream *s_root, stream *s, type_tree_entry_number_long *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entry_number_long(type_tree_entry_number_long *data);
int stream_read_type_subcontrols(stream *s_root, stream *s, type_subcontrols *data, type_uiribbon *_root);
int stream_write_type_subcontrols(stream *s_root, stream *s, type_subcontrols *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_subcontrols(type_subcontrols *data);
int stream_read_type_tree_entry_number(stream *s_root, stream *s, type_tree_entry_number *data, type_uiribbon *_root);
int stream_write_type_tree_entry_number(stream *s_root, stream *s, type_tree_entry_number *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entry_number(type_tree_entry_number *data);
int stream_read_type_tree_entry_array(stream *s_root, stream *s, type_tree_entry_array *data, type_uiribbon *_root);
int stream_write_type_tree_entry_array(stream *s_root, stream *s, type_tree_entry_array *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entry_array(type_tree_entry_array *data);
int stream_read_type_tree_entries(stream *s_root, stream *s, type_tree_entries *data, type_uiribbon *_root);
int stream_write_type_tree_entries(stream *s_root, stream *s, type_tree_entries *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entries(type_tree_entries *data);
int stream_read_type_block_node(stream *s_root, stream *s, type_block_node *data, type_uiribbon *_root);
int stream_write_type_block_node(stream *s_root, stream *s, type_block_node *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_block_node(type_block_node *data);
int stream_read_type_tree_entry(stream *s_root, stream *s, type_tree_entry *data, type_uiribbon *_root);
int stream_write_type_tree_entry(stream *s_root, stream *s, type_tree_entry *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entry(type_tree_entry *data);
int stream_read_type_tree_entry_ext(stream *s_root, stream *s, type_tree_entry_ext *data, type_uiribbon *_root);
int stream_write_type_tree_entry_ext(stream *s_root, stream *s, type_tree_entry_ext *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_tree_entry_ext(type_tree_entry_ext *data);
int stream_read_type_control(stream *s_root, stream *s, type_control *data, type_uiribbon *_root);
int stream_write_type_control(stream *s_root, stream *s, type_control *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_control(type_control *data);
int stream_read_type_command(stream *s_root, stream *s, type_command *data, type_uiribbon *_root);
int stream_write_type_command(stream *s_root, stream *s, type_command *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_command(type_command *data);
int stream_read_type_command_container(stream *s_root, stream *s, type_command_container *data, type_uiribbon *_root);
int stream_write_type_command_container(stream *s_root, stream *s, type_command_container *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_command_container(type_command_container *data);
int stream_read_type_command_ext5(stream *s_root, stream *s, type_command_ext5 *data, type_uiribbon *_root);
int stream_write_type_command_ext5(stream *s_root, stream *s, type_command_ext5 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_command_ext5(type_command_ext5 *data);
int stream_read_type_command_ext4(stream *s_root, stream *s, type_command_ext4 *data, type_uiribbon *_root);
int stream_write_type_command_ext4(stream *s_root, stream *s, type_command_ext4 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_command_ext4(type_command_ext4 *data);
int stream_read_type_command_ext3(stream *s_root, stream *s, type_command_ext3 *data, type_uiribbon *_root);
int stream_write_type_command_ext3(stream *s_root, stream *s, type_command_ext3 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_command_ext3(type_command_ext3 *data);
int stream_read_type_command_ext2(stream *s_root, stream *s, type_command_ext2 *data, type_uiribbon *_root);
int stream_write_type_command_ext2(stream *s_root, stream *s, type_command_ext2 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_command_ext2(type_command_ext2 *data);
int stream_read_type_uiribbon(stream *s_root, stream *s, type_uiribbon *data, type_uiribbon *_root);
int stream_write_type_uiribbon(stream *s_root, stream *s, type_uiribbon *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root);
void stream_free_type_uiribbon(type_uiribbon *data);

int stream_read_type_id(stream *s_root, stream *s, type_id *data, type_uiribbon *_root)
{
	int32_t id_block_2;
	int16_t id_block_3;
	int8_t id_block_4;
	int8_t id_block_9;
	int8_t id_block_43;

	CHECK(stream_read_uint8_t(s_root, s, &data->flag, _root));
	switch(data->flag)
	{
		case 2:
		{
			CHECK(stream_read_int32_t(s_root, s, &id_block_2, _root));
			data->id = id_block_2;
			break;
		}
		case 3:
		{
			CHECK(stream_read_int16_t(s_root, s, &id_block_3, _root));
			data->id = id_block_3;
			break;
		}
		case 4:
		{
			CHECK(stream_read_int8_t(s_root, s, &id_block_4, _root));
			data->id = id_block_4;
			break;
		}
		case 9:
		{
			CHECK(stream_read_int8_t(s_root, s, &id_block_9, _root));
			data->id = id_block_9;
			break;
		}
		case 43:
		{
			CHECK(stream_read_int8_t(s_root, s, &id_block_43, _root));
			data->id = id_block_43;
			break;
		}
	}
	return 0;
}

int stream_write_type_id(stream *s_root, stream *s, type_id *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int32_t id_block_2;
	int16_t id_block_3;
	int8_t id_block_4;
	int8_t id_block_9;
	int8_t id_block_43;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint8_t(s_root, s, &data->flag, stage, do_sequence, _root));
	switch(data->flag)
	{
		case 2:
		{
			id_block_2 = data->id;
			CHECK(stream_write_int32_t(s_root, s, &id_block_2, stage, do_sequence, _root));
			break;
		}
		case 3:
		{
			id_block_3 = data->id;
			CHECK(stream_write_int16_t(s_root, s, &id_block_3, stage, do_sequence, _root));
			break;
		}
		case 4:
		{
			id_block_4 = data->id;
			CHECK(stream_write_int8_t(s_root, s, &id_block_4, stage, do_sequence, _root));
			break;
		}
		case 9:
		{
			id_block_9 = data->id;
			CHECK(stream_write_int8_t(s_root, s, &id_block_9, stage, do_sequence, _root));
			break;
		}
		case 43:
		{
			id_block_43 = data->id;
			CHECK(stream_write_int8_t(s_root, s, &id_block_43, stage, do_sequence, _root));
			break;
		}
	}
	return 0;
}

void stream_free_type_id(type_id *data)
{
	switch(data->flag)
	{
		case 2:
		{
			break;
		}
		case 3:
		{
			break;
		}
		case 4:
		{
			break;
		}
		case 9:
		{
			break;
		}
		case 43:
		{
			break;
		}
	}
}

int stream_read_type_string(stream *s_root, stream *s, type_string *data, type_uiribbon *_root)
{
	const char unk1[] = {1};

	CHECK(stream_read_expect_bytes(s, unk1));
	CHECK(stream_read_uint16_t(s_root, s, &data->size_str, _root));
	data->str = malloc(data->size_str);
	CHECK(stream_read_bytes(s, data->str, data->size_str));
	return 0;
}

int stream_write_type_string(stream *s_root, stream *s, type_string *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	const char unk1[] = {1};

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_bytes(s, unk1, sizeof(unk1), stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->size_str, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, data->str, data->size_str, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_string(type_string *data)
{
	free(data->str);
}

int stream_read_type_strings(stream *s_root, stream *s, type_strings *data, type_uiribbon *_root)
{
	const char unk1[] = {1};
	int i;

	CHECK(stream_read_expect_bytes(s, unk1));
	CHECK(stream_read_uint8_t(s_root, s, &data->count_strings, _root));
	data->strings = malloc(sizeof(type_string) * data->count_strings);
	for (i = 0; i < data->count_strings; i++)
	{
		CHECK(stream_read_type_string(s_root, s, &data->strings[i], _root));
	}
	CHECK(stream_read_uint8_t(s_root, s, &data->unk2, _root));
	return 0;
}

int stream_write_type_strings(stream *s_root, stream *s, type_strings *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	const char unk1[] = {1};
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_bytes(s, unk1, sizeof(unk1), stage, do_sequence, _root));
	CHECK(stream_write_uint8_t(s_root, s, &data->count_strings, stage, do_sequence, _root));
	for (i = 0; i < data->count_strings; i++)
	{
		CHECK(stream_write_type_string(s_root, s, &data->strings[i], stage, do_sequence, _root));
	}
	CHECK(stream_write_uint8_t(s_root, s, &data->unk2, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_strings(type_strings *data)
{
	int i;

	for (i = 0; i < data->count_strings; i++)
	{
		stream_free_type_string(&data->strings[i]);
	}
	free(data->strings);
}

int stream_read_type_resource_generic(stream *s_root, stream *s, type_resource_generic *data, type_uiribbon *_root)
{
	uint8_t resource_type;

	CHECK(stream_read_uint8_t(s_root, s, &resource_type, _root));
	data->resource_type = resource_type;
	CHECK(stream_read_uint32_t(s_root, s, &data->resource_id, _root));
	if (data->resource_type == ENUM_RESOURCE_TYPE_LARGEIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_SMALLIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_LARGEHIGHCONTRASTIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_SMALLHIGHCONTRASTIMAGE)
	{
		CHECK(stream_read_uint16_t(s_root, s, &data->mindpi, _root));
	}
	return 0;
}

int stream_write_type_resource_generic(stream *s_root, stream *s, type_resource_generic *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	uint8_t resource_type;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	resource_type = data->resource_type;
	CHECK(stream_write_uint8_t(s_root, s, &resource_type, stage, do_sequence, _root));
	CHECK(stream_write_uint32_t(s_root, s, &data->resource_id, stage, do_sequence, _root));
	if (data->resource_type == ENUM_RESOURCE_TYPE_LARGEIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_SMALLIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_LARGEHIGHCONTRASTIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_SMALLHIGHCONTRASTIMAGE)
	{
		CHECK(stream_write_uint16_t(s_root, s, &data->mindpi, stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_resource_generic(type_resource_generic *data)
{
	if (data->resource_type == ENUM_RESOURCE_TYPE_LARGEIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_SMALLIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_LARGEHIGHCONTRASTIMAGE || data->resource_type == ENUM_RESOURCE_TYPE_SMALLHIGHCONTRASTIMAGE)
	{
	}
}

int stream_read_type_resource(stream *s_root, stream *s, type_resource *data, type_uiribbon *_root)
{
	int i;

	CHECK(stream_read_uint32_t(s_root, s, &data->command_id, _root));
	CHECK(stream_read_uint8_t(s_root, s, &data->count_resources, _root));
	data->resources = malloc(sizeof(type_resource_generic) * data->count_resources);
	for (i = 0; i < data->count_resources; i++)
	{
		CHECK(stream_read_type_resource_generic(s_root, s, &data->resources[i], _root));
	}
	return 0;
}

int stream_write_type_resource(stream *s_root, stream *s, type_resource *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint32_t(s_root, s, &data->command_id, stage, do_sequence, _root));
	CHECK(stream_write_uint8_t(s_root, s, &data->count_resources, stage, do_sequence, _root));
	for (i = 0; i < data->count_resources; i++)
	{
		CHECK(stream_write_type_resource_generic(s_root, s, &data->resources[i], stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_resource(type_resource *data)
{
	int i;

	for (i = 0; i < data->count_resources; i++)
	{
		stream_free_type_resource_generic(&data->resources[i]);
	}
	free(data->resources);
}

int stream_read_type_sizedefinitions_order_command(stream *s_root, stream *s, type_sizedefinitions_order_command *data, type_uiribbon *_root)
{
	uint8_t flags_command;

	CHECK(stream_read_uint8_t(s_root, s, &data->unk1, _root));
	CHECK(stream_read_uint8_t(s_root, s, &flags_command, _root));
	data->flags_command = flags_command;
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_SPECIAL)
	{
		CHECK(stream_read_uint8_t(s_root, s, &data->string_id, _root));
	}
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_COMMAND)
	{
		CHECK(stream_read_uint16_t(s_root, s, &data->command_id, _root));
	}
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_COMMAND_INTERNAL)
	{
		CHECK(stream_read_uint32_t(s_root, s, &data->unk2, _root));
	}
	return 0;
}

int stream_write_type_sizedefinitions_order_command(stream *s_root, stream *s, type_sizedefinitions_order_command *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	uint8_t flags_command;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint8_t(s_root, s, &data->unk1, stage, do_sequence, _root));
	flags_command = data->flags_command;
	CHECK(stream_write_uint8_t(s_root, s, &flags_command, stage, do_sequence, _root));
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_SPECIAL)
	{
		CHECK(stream_write_uint8_t(s_root, s, &data->string_id, stage, do_sequence, _root));
	}
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_COMMAND)
	{
		CHECK(stream_write_uint16_t(s_root, s, &data->command_id, stage, do_sequence, _root));
	}
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_COMMAND_INTERNAL)
	{
		CHECK(stream_write_uint32_t(s_root, s, &data->unk2, stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_sizedefinitions_order_command(type_sizedefinitions_order_command *data)
{
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_SPECIAL)
	{
	}
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_COMMAND)
	{
	}
	if (data->flags_command == ENUM_SIZEDEFINITIONS_COMMAND_COMMAND_INTERNAL)
	{
	}
}

int stream_read_type_sizedefinition_order(stream *s_root, stream *s, type_sizedefinition_order *data, type_uiribbon *_root)
{
	int i;

	CHECK(stream_read_uint16_t(s_root, s, &data->count_commands, _root));
	data->commands = malloc(sizeof(type_sizedefinitions_order_command) * data->count_commands);
	for (i = 0; i < data->count_commands; i++)
	{
		CHECK(stream_read_type_sizedefinitions_order_command(s_root, s, &data->commands[i], _root));
	}
	return 0;
}

int stream_write_type_sizedefinition_order(stream *s_root, stream *s, type_sizedefinition_order *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint16_t(s_root, s, &data->count_commands, stage, do_sequence, _root));
	for (i = 0; i < data->count_commands; i++)
	{
		CHECK(stream_write_type_sizedefinitions_order_command(s_root, s, &data->commands[i], stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_sizedefinition_order(type_sizedefinition_order *data)
{
	int i;

	for (i = 0; i < data->count_commands; i++)
	{
		stream_free_type_sizedefinitions_order_command(&data->commands[i]);
	}
	free(data->commands);
}

int stream_read_type_tree_entry_number_variable(stream *s_root, stream *s, type_tree_entry_number_variable *data, type_uiribbon *_root)
{
	CHECK(stream_read_type_id(s_root, s, &data->id, _root));
	return 0;
}

int stream_write_type_tree_entry_number_variable(stream *s_root, stream *s, type_tree_entry_number_variable *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_type_id(s_root, s, &data->id, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_tree_entry_number_variable(type_tree_entry_number_variable *data)
{
	stream_free_type_id(&data->id);
}

int stream_read_type_tree_entry_number_long(stream *s_root, stream *s, type_tree_entry_number_long *data, type_uiribbon *_root)
{
	CHECK(stream_read_uint32_t(s_root, s, &data->unk1, _root));
	CHECK(stream_read_uint8_t(s_root, s, &data->value1, _root));
	return 0;
}

int stream_write_type_tree_entry_number_long(stream *s_root, stream *s, type_tree_entry_number_long *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint32_t(s_root, s, &data->unk1, stage, do_sequence, _root));
	CHECK(stream_write_uint8_t(s_root, s, &data->value1, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_tree_entry_number_long(type_tree_entry_number_long *data)
{
}

int stream_read_type_subcontrols(stream *s_root, stream *s, type_subcontrols *data, type_uiribbon *_root)
{
	int i;

	CHECK(stream_read_uint16_t(s_root, s, &data->count_subcontrols, _root));
	data->subcontrols = malloc(sizeof(type_control) * data->count_subcontrols);
	for (i = 0; i < data->count_subcontrols; i++)
	{
		CHECK(stream_read_type_control(s_root, s, &data->subcontrols[i], _root));
	}
	return 0;
}

int stream_write_type_subcontrols(stream *s_root, stream *s, type_subcontrols *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint16_t(s_root, s, &data->count_subcontrols, stage, do_sequence, _root));
	for (i = 0; i < data->count_subcontrols; i++)
	{
		CHECK(stream_write_type_control(s_root, s, &data->subcontrols[i], stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_subcontrols(type_subcontrols *data)
{
	int i;

	for (i = 0; i < data->count_subcontrols; i++)
	{
		stream_free_type_control(&data->subcontrols[i]);
	}
	free(data->subcontrols);
}

int stream_read_type_tree_entry_number(stream *s_root, stream *s, type_tree_entry_number *data, type_uiribbon *_root)
{
	uint8_t block_type;

	CHECK(stream_read_uint8_t(s_root, s, &data->block_len, _root));
	CHECK(stream_read_uint8_t(s_root, s, &block_type, _root));
	data->block_type = block_type;
	if (data->block_len == 1)
	{
		CHECK(stream_read_type_tree_entry_number_variable(s_root, s, &data->content_number, _root));
	}
	if (data->block_len == 4)
	{
		CHECK(stream_read_type_tree_entry_number_long(s_root, s, &data->content_long, _root));
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_ID)
	{
		data->id = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_SIZEDEFINITION_LABELVISIBLE_MIXED)
	{
		data->sizedefinition_labelvisible_mixed = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_SIZEDEFINITION_LABELVISIBLE)
	{
		data->sizedefinition_labelvisible = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_SIZEDEFINITION_IMAGEVISIBLE)
	{
		data->sizedefinition_imagevisible = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_SIZEDEFINITION_IMAGESIZE)
	{
		data->sizedefinition_imagesize = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_SIZEDEFINITION_IMAGESIZE_MIXED)
	{
		data->sizedefinition_imagesize_mixed = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_AUTOCOMPLETE_ENABLED)
	{
		data->autocomplete_enabled = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_TYPE)
	{
		data->gallery_type = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_COLORTEMPLATE)
	{
		data->dropdowncolorpicker_colortemplate = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_CHIPSIZE)
	{
		data->dropdowncolorpicker_chipsize = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_COLUMNS)
	{
		data->dropdowncolorpicker_columns = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_HAS_AUTOCOLOR_BUTTON)
	{
		data->dropdowncolorpicker_has_autocolor_button = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_HAS_NOCOLOR_BUTTON)
	{
		data->dropdowncolorpicker_has_nocolor_button = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_RECENT_COLOR_ROWS)
	{
		data->dropdowncolorpicker_recent_color_rows = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_STANDARD_COLOR_ROWS)
	{
		data->dropdowncolorpicker_standard_rows = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_DROPDOWNCOLORPICKER_THEME_COLOR_ROWS)
	{
		data->dropdowncolorpicker_theme_color_rows = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_META_INFO)
	{
		data->gallery_elements_type = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_HAS_LARGE_ITEMS)
	{
		data->gallery_has_large_items = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_ITEM_HEIGHT)
	{
		data->gallery_item_height = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_ITEM_WIDTH)
	{
		data->gallery_item_width = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_TEXT_POSITION)
	{
		data->gallery_text_position = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_MENULAYOUT)
	{
		data->gallery_menulayout = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_GRIPPER)
	{
		data->gallery_gripper = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_ROWS)
	{
		data->gallery_rows = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_COLUMNS)
	{
		data->gallery_columns = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_MAX_ROWS)
	{
		data->gallery_max_rows = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_MAX_COLUMNS)
	{
		data->gallery_max_columns = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_MIN_COLUMNS_LARGE)
	{
		data->gallery_min_columns_large = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_MAX_COLUMNS_MEDIUM)
	{
		data->gallery_max_columns_medium = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_GALLERY_MIN_COLUMNS_MEDIUM)
	{
		data->gallery_min_columns_medium = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_IS_CHECKBOX)
	{
		data->is_checkbox = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_META_INFO)
	{
		data->scalepolicy = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_META_INFO)
	{
		data->scalepolicy_medium = data->scalepolicy / 256;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_META_INFO)
	{
		data->scalepolicy_small = (data->scalepolicy % 256) / 16;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_META_INFO)
	{
		data->scalepolicy_popup = (data->scalepolicy % 16) / 1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_ID_REFERENCE)
	{
		data->id_reference = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_ENABLE_PINNING)
	{
		data->enable_pinning = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_FONTCONTROL_STR)
	{
		data->fontcontrol_str = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_FONTCONTROL_FONTSIZE_MIN)
	{
		data->fontcontrol_fontsize_min = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_FONTCONTROL_FONTSIZE_MAX)
	{
		data->fontcontrol_fontsize_max = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_FONTCONTROL_PARENT_COMMANDID)
	{
		data->fontcontrol_parent_commandid = data->content_number.id.id;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_FONTCONTROL_TRUETYPEONLY)
	{
		data->fontcontrol_truetypeonly = data->content_long.value1;
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_NUMBER_FONTCONTROL_VERTICALFONTS)
	{
		data->fontcontrol_verticalfonts = data->content_long.value1;
	}
	return 0;
}

int stream_write_type_tree_entry_number(stream *s_root, stream *s, type_tree_entry_number *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	uint8_t block_type;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint8_t(s_root, s, &data->block_len, stage, do_sequence, _root));
	block_type = data->block_type;
	CHECK(stream_write_uint8_t(s_root, s, &block_type, stage, do_sequence, _root));
	if (data->block_len == 1)
	{
		CHECK(stream_write_type_tree_entry_number_variable(s_root, s, &data->content_number, stage, do_sequence, _root));
	}
	if (data->block_len == 4)
	{
		CHECK(stream_write_type_tree_entry_number_long(s_root, s, &data->content_long, stage, do_sequence, _root));
	}

	/* Start writing instance data */
	if (!do_sequence)
	{
	}
	return 0;
}

void stream_free_type_tree_entry_number(type_tree_entry_number *data)
{
	if (data->block_len == 1)
	{
		stream_free_type_tree_entry_number_variable(&data->content_number);
	}
	if (data->block_len == 4)
	{
		stream_free_type_tree_entry_number_long(&data->content_long);
	}
}

int stream_read_type_tree_entry_array(stream *s_root, stream *s, type_tree_entry_array *data, type_uiribbon *_root)
{
	uint8_t block_type;

	CHECK(stream_read_uint8_t(s_root, s, &data->block_len, _root));
	CHECK(stream_read_uint8_t(s_root, s, &block_type, _root));
	data->block_type = block_type;
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SUBCOMPONENTS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_GALLERY_SUBCONTROLS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_BUTTONITEM || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_APPLICATION_MENU || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_NORMAL || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_CONTEXT || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_QUICKACCESS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_HELP || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_CONTEXTPOPUPS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_UNK73)
	{
		CHECK(stream_read_type_subcontrols(s_root, s, &data->content_subcontrols, _root));
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_LARGE || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_MEDIUM || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_SMALL)
	{
		CHECK(stream_read_type_sizedefinition_order(s_root, s, &data->sizedefinition_order, _root));
	}
	return 0;
}

int stream_write_type_tree_entry_array(stream *s_root, stream *s, type_tree_entry_array *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	uint8_t block_type;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint8_t(s_root, s, &data->block_len, stage, do_sequence, _root));
	block_type = data->block_type;
	CHECK(stream_write_uint8_t(s_root, s, &block_type, stage, do_sequence, _root));
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SUBCOMPONENTS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_GALLERY_SUBCONTROLS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_BUTTONITEM || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_APPLICATION_MENU || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_NORMAL || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_CONTEXT || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_QUICKACCESS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_HELP || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_CONTEXTPOPUPS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_UNK73)
	{
		CHECK(stream_write_type_subcontrols(s_root, s, &data->content_subcontrols, stage, do_sequence, _root));
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_LARGE || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_MEDIUM || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_SMALL)
	{
		CHECK(stream_write_type_sizedefinition_order(s_root, s, &data->sizedefinition_order, stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_tree_entry_array(type_tree_entry_array *data)
{
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SUBCOMPONENTS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_GALLERY_SUBCONTROLS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_BUTTONITEM || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_APPLICATION_MENU || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_NORMAL || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_CONTEXT || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_QUICKACCESS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_TABS_HELP || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_CONTEXTPOPUPS || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_UNK73)
	{
		stream_free_type_subcontrols(&data->content_subcontrols);
	}
	if (data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_LARGE || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_MEDIUM || data->block_type == ENUM_CONTROL_BLOCK_TYPE_SPECIAL_SIZEDEFINITION_ORDER_SMALL)
	{
		stream_free_type_sizedefinition_order(&data->sizedefinition_order);
	}
}

int stream_read_type_tree_entries(stream *s_root, stream *s, type_tree_entries *data, type_uiribbon *_root)
{
	int i;

	CHECK(stream_read_uint8_t(s_root, s, &data->count_blocks, _root));
	data->blocks = malloc(sizeof(type_tree_entry) * data->count_blocks);
	for (i = 0; i < data->count_blocks; i++)
	{
		CHECK(stream_read_type_tree_entry(s_root, s, &data->blocks[i], _root));
	}
	return 0;
}

int stream_write_type_tree_entries(stream *s_root, stream *s, type_tree_entries *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint8_t(s_root, s, &data->count_blocks, stage, do_sequence, _root));
	for (i = 0; i < data->count_blocks; i++)
	{
		CHECK(stream_write_type_tree_entry(s_root, s, &data->blocks[i], stage, do_sequence, _root));
	}
	return 0;
}

void stream_free_type_tree_entries(type_tree_entries *data)
{
	int i;

	for (i = 0; i < data->count_blocks; i++)
	{
		stream_free_type_tree_entry(&data->blocks[i]);
	}
	free(data->blocks);
}

int stream_read_type_block_node(stream *s_root, stream *s, type_block_node *data, type_uiribbon *_root)
{
	uint16_t type;
	stream substream_children;

	CHECK(stream_read_uint8_t(s_root, s, &data->unk56, _root));
	CHECK(stream_read_uint16_t(s_root, s, &type, _root));
	data->type = type;
	CHECK(stream_read_uint8_t(s_root, s, &data->unk3, _root));
	CHECK(stream_read_uint16_t(s_root, s, &data->len4, _root));
	CHECK(stream_read_make_substream(s, &substream_children, data->len4 - 7));
	CHECK(stream_read_type_tree_entries(s_root, &substream_children, &data->children, _root));
	return 0;
}

int stream_write_type_block_node(stream *s_root, stream *s, type_block_node *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	uint16_t type;
	stream substream_children;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint8_t(s_root, s, &data->unk56, stage, do_sequence, _root));
	type = data->type;
	CHECK(stream_write_uint16_t(s_root, s, &type, stage, do_sequence, _root));
	CHECK(stream_write_uint8_t(s_root, s, &data->unk3, stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->len4, stage, do_sequence, _root));
	CHECK(stream_write_make_substream(s, &substream_children));
	CHECK(stream_write_type_tree_entries(s_root, &substream_children, &data->children, stage, do_sequence, _root));
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->len4 = stream_write_get_length(&substream_children) - (- 7);
	}
	return 0;
}

void stream_free_type_block_node(type_block_node *data)
{
	stream_free_type_tree_entries(&data->children);
}

int stream_read_type_tree_entry(stream *s_root, stream *s, type_tree_entry *data, type_uiribbon *_root)
{
	uint8_t entry_type;
	stream substream_instance_ext;

	CHECK(stream_read_uint8_t(s_root, s, &entry_type, _root));
	data->entry_type = entry_type;
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_PROPERTY)
	{
		CHECK(stream_read_type_tree_entry_number(s_root, s, &data->property, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_ARRAY)
	{
		CHECK(stream_read_type_tree_entry_array(s_root, s, &data->array, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_NODE)
	{
		CHECK(stream_read_type_block_node(s_root, s, &data->node, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_EXT)
	{
		CHECK(stream_read_uint32_t(s_root, s, &data->ext_pos, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_EXT)
	{
		CHECK(stream_read_make_substream_instance(s_root, &substream_instance_ext, (data->ext_pos), s_root->max - (data->ext_pos)));
		data->ext = malloc(sizeof(type_tree_entry_ext));
		CHECK(stream_read_type_tree_entry_ext(s_root, &substream_instance_ext, data->ext, _root));
	}
	return 0;
}

int stream_write_type_tree_entry(stream *s_root, stream *s, type_tree_entry *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	uint8_t entry_type;
	stream substream_instance_ext;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	entry_type = data->entry_type;
	CHECK(stream_write_uint8_t(s_root, s, &entry_type, stage, do_sequence, _root));
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_PROPERTY)
	{
		CHECK(stream_write_type_tree_entry_number(s_root, s, &data->property, stage, do_sequence, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_ARRAY)
	{
		CHECK(stream_write_type_tree_entry_array(s_root, s, &data->array, stage, do_sequence, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_NODE)
	{
		CHECK(stream_write_type_block_node(s_root, s, &data->node, stage, do_sequence, _root));
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_EXT)
	{
		CHECK(stream_write_uint32_t(s_root, s, &data->ext_pos, stage, do_sequence, _root));
	}

	/* Start writing instance data */
	if (!do_sequence)
	{
		/* Store position for instance */
		if (stage == STREAM_WRITE_STAGE_DRYRUN)
		{
			data->_dryrun_pos_instance_ext = stream_write_get_position_absolute(s_root);
			data->ext_pos = stream_write_get_position_absolute(s_root);
		}
		if (data->entry_type == ENUM_TREE_ENTRY_TYPE_EXT)
		{
			/* Make substream for instance */
			if (stage == STREAM_WRITE_STAGE_WRITE)
			{
				CHECK(stream_write_make_substream_instance(s_root, &substream_instance_ext, data->_dryrun_pos_instance_ext));
			}
			else
			{
				CHECK(stream_write_make_substream(s_root, &substream_instance_ext));
			}

			/* Write instance */
			CHECK(stream_write_type_tree_entry_ext(s_root, &substream_instance_ext, data->ext, stage, TRUE, _root));
			CHECK(stream_write_type_tree_entry_ext(s_root, &substream_instance_ext, data->ext, stage, FALSE, _root));
		}
	}
	return 0;
}

void stream_free_type_tree_entry(type_tree_entry *data)
{
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_PROPERTY)
	{
		stream_free_type_tree_entry_number(&data->property);
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_ARRAY)
	{
		stream_free_type_tree_entry_array(&data->array);
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_NODE)
	{
		stream_free_type_block_node(&data->node);
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_EXT)
	{
	}
	if (data->entry_type == ENUM_TREE_ENTRY_TYPE_EXT)
	{
		stream_free_type_tree_entry_ext(data->ext);
		free(data->ext);
	}
}

int stream_read_type_tree_entry_ext(stream *s_root, stream *s, type_tree_entry_ext *data, type_uiribbon *_root)
{
	CHECK(stream_read_uint16_t(s_root, s, &data->len_ext, _root));
	CHECK(stream_read_type_tree_entry(s_root, s, &data->block, _root));
	return 0;
}

int stream_write_type_tree_entry_ext(stream *s_root, stream *s, type_tree_entry_ext *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint16_t(s_root, s, &data->len_ext, stage, do_sequence, _root));
	CHECK(stream_write_type_tree_entry(s_root, s, &data->block, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_tree_entry_ext(type_tree_entry_ext *data)
{
	stream_free_type_tree_entry(&data->block);
}

int stream_read_type_control(stream *s_root, stream *s, type_control *data, type_uiribbon *_root)
{
	const char unk1[] = {22, 0};
	uint16_t block_type;
	stream substream_blocks;

	CHECK(stream_read_expect_bytes(s, unk1));
	CHECK(stream_read_uint16_t(s_root, s, &block_type, _root));
	data->block_type = block_type;
	CHECK(stream_read_uint8_t(s_root, s, &data->unk2, _root));
	CHECK(stream_read_uint16_t(s_root, s, &data->size_block, _root));
	CHECK(stream_read_make_substream(s, &substream_blocks, data->size_block - 7));
	CHECK(stream_read_type_tree_entries(s_root, &substream_blocks, &data->blocks, _root));
	return 0;
}

int stream_write_type_control(stream *s_root, stream *s, type_control *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	const char unk1[] = {22, 0};
	uint16_t block_type;
	stream substream_blocks;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_bytes(s, unk1, sizeof(unk1), stage, do_sequence, _root));
	block_type = data->block_type;
	CHECK(stream_write_uint16_t(s_root, s, &block_type, stage, do_sequence, _root));
	CHECK(stream_write_uint8_t(s_root, s, &data->unk2, stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->size_block, stage, do_sequence, _root));
	CHECK(stream_write_make_substream(s, &substream_blocks));
	CHECK(stream_write_type_tree_entries(s_root, &substream_blocks, &data->blocks, stage, do_sequence, _root));
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->size_block = stream_write_get_length(&substream_blocks) - (- 7);
	}
	return 0;
}

void stream_free_type_control(type_control *data)
{
	stream_free_type_tree_entries(&data->blocks);
}

int stream_read_type_command(stream *s_root, stream *s, type_command *data, type_uiribbon *_root)
{
	CHECK(stream_read_uint16_t(s_root, s, &data->command_id, _root));
	data->unk1 = malloc(3);
	CHECK(stream_read_bytes(s, data->unk1, 3));
	CHECK(stream_read_uint8_t(s_root, s, &data->unk3b, _root));
	data->unk4 = malloc(2);
	CHECK(stream_read_bytes(s, data->unk4, 2));
	CHECK(stream_read_uint16_t(s_root, s, &data->size_str, _root));
	data->str = malloc(data->size_str);
	CHECK(stream_read_bytes(s, data->str, data->size_str));
	return 0;
}

int stream_write_type_command(stream *s_root, stream *s, type_command *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint16_t(s_root, s, &data->command_id, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, data->unk1, 3, stage, do_sequence, _root));
	CHECK(stream_write_uint8_t(s_root, s, &data->unk3b, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, data->unk4, 2, stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->size_str, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, data->str, data->size_str, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_command(type_command *data)
{
	free(data->unk1);
	free(data->unk4);
	free(data->str);
}

int stream_read_type_command_container(stream *s_root, stream *s, type_command_container *data, type_uiribbon *_root)
{
	int i;

	CHECK(stream_read_uint32_t(s_root, s, &data->commands_len, _root));
	data->commands = malloc(sizeof(type_command) * data->commands_len);
	for (i = 0; i < data->commands_len; i++)
	{
		CHECK(stream_read_type_command(s_root, s, &data->commands[i], _root));
	}
	CHECK(stream_read_uint8_t(s_root, s, &data->unk1, _root));
	return 0;
}

int stream_write_type_command_container(stream *s_root, stream *s, type_command_container *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint32_t(s_root, s, &data->commands_len, stage, do_sequence, _root));
	for (i = 0; i < data->commands_len; i++)
	{
		CHECK(stream_write_type_command(s_root, s, &data->commands[i], stage, do_sequence, _root));
	}
	CHECK(stream_write_uint8_t(s_root, s, &data->unk1, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_command_container(type_command_container *data)
{
	int i;

	for (i = 0; i < data->commands_len; i++)
	{
		stream_free_type_command(&data->commands[i]);
	}
	free(data->commands);
}

int stream_read_type_command_ext5(stream *s_root, stream *s, type_command_ext5 *data, type_uiribbon *_root)
{
	const char unk3[] = {0, 0};
	const char unk5[] = {0, 0};

	CHECK(stream_read_uint16_t(s_root, s, &data->command_id, _root));
	CHECK(stream_read_uint16_t(s_root, s, &data->count, _root));
	CHECK(stream_read_expect_bytes(s, unk3));
	CHECK(stream_read_uint16_t(s_root, s, &data->offset, _root));
	CHECK(stream_read_expect_bytes(s, unk5));
	return 0;
}

int stream_write_type_command_ext5(stream *s_root, stream *s, type_command_ext5 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	const char unk3[] = {0, 0};
	const char unk5[] = {0, 0};

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint16_t(s_root, s, &data->command_id, stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->count, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, unk3, sizeof(unk3), stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->offset, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, unk5, sizeof(unk5), stage, do_sequence, _root));
	return 0;
}

void stream_free_type_command_ext5(type_command_ext5 *data)
{
}

int stream_read_type_command_ext4(stream *s_root, stream *s, type_command_ext4 *data, type_uiribbon *_root)
{
	int i;

	data->blocks = NULL;
	i = -1;
	do
	{
		i += 1;
		data->blocks = realloc(data->blocks, sizeof(type_command_ext5) * (i + 1));
		CHECK(stream_read_type_command_ext5(s_root, s, &data->blocks[i], _root));
	}
	while(s->start + s->pos < s->max);
	data->blocks_count = i;
	return 0;
}

int stream_write_type_command_ext4(stream *s_root, stream *s, type_command_ext4 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	int i;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	i = -1;
	do
	{
		i += 1;
		CHECK(stream_write_type_command_ext5(s_root, s, &data->blocks[i], stage, do_sequence, _root));
	}
	while(i + 1 < data->blocks_count);
	return 0;
}

void stream_free_type_command_ext4(type_command_ext4 *data)
{
	int i;

	i = -1;
	do
	{
		i += 1;
		stream_free_type_command_ext5(&data->blocks[i]);
	}
	while(i + 1 < data->blocks_count);
	free(data->blocks);
}

int stream_read_type_command_ext3(stream *s_root, stream *s, type_command_ext3 *data, type_uiribbon *_root)
{
	stream substream_unk3;

	CHECK(stream_read_uint16_t(s_root, s, &data->size_commands, _root));
	CHECK(stream_read_uint16_t(s_root, s, &data->unk2, _root));
	CHECK(stream_read_make_substream(s, &substream_unk3, data->size_commands - 4));
	CHECK(stream_read_type_command_ext4(s_root, &substream_unk3, &data->unk3, _root));
	return 0;
}

int stream_write_type_command_ext3(stream *s_root, stream *s, type_command_ext3 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	stream substream_unk3;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_uint16_t(s_root, s, &data->size_commands, stage, do_sequence, _root));
	CHECK(stream_write_uint16_t(s_root, s, &data->unk2, stage, do_sequence, _root));
	CHECK(stream_write_make_substream(s, &substream_unk3));
	CHECK(stream_write_type_command_ext4(s_root, &substream_unk3, &data->unk3, stage, do_sequence, _root));
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->size_commands = stream_write_get_length(&substream_unk3) - (- 4);
	}
	return 0;
}

void stream_free_type_command_ext3(type_command_ext3 *data)
{
	stream_free_type_command_ext4(&data->unk3);
}

int stream_read_type_command_ext2(stream *s_root, stream *s, type_command_ext2 *data, type_uiribbon *_root)
{
	stream substream_instance_ext;

	CHECK(stream_read_make_substream_instance(s_root, &substream_instance_ext, (_root->command_ext_pos), s_root->max - (_root->command_ext_pos)));
	data->ext = malloc(sizeof(type_command_ext3));
	CHECK(stream_read_type_command_ext3(s_root, &substream_instance_ext, data->ext, _root));
	return 0;
}

int stream_write_type_command_ext2(stream *s_root, stream *s, type_command_ext2 *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	stream substream_instance_ext;

	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;


	/* Start writing instance data */
	if (!do_sequence)
	{
		/* Store position for instance */
		if (stage == STREAM_WRITE_STAGE_DRYRUN)
		{
			data->_dryrun_pos_instance_ext = stream_write_get_position_absolute(s_root);
			_root->command_ext_pos = stream_write_get_position_absolute(s_root);
		}

		/* Make substream for instance */
		if (stage == STREAM_WRITE_STAGE_WRITE)
		{
			CHECK(stream_write_make_substream_instance(s_root, &substream_instance_ext, data->_dryrun_pos_instance_ext));
		}
		else
		{
			CHECK(stream_write_make_substream(s_root, &substream_instance_ext));
		}

		/* Write instance */
		CHECK(stream_write_type_command_ext3(s_root, &substream_instance_ext, data->ext, stage, TRUE, _root));
		CHECK(stream_write_type_command_ext3(s_root, &substream_instance_ext, data->ext, stage, FALSE, _root));
	}
	return 0;
}

void stream_free_type_command_ext2(type_command_ext2 *data)
{
	stream_free_type_command_ext3(data->ext);
	free(data->ext);
}

int stream_read_type_uiribbon(stream *s_root, stream *s, type_uiribbon *data, type_uiribbon *_root)
{
	const char unknown1[] = {0, 18, 0, 0, 0, 0, 0, 1, 0};
	const char magic[] = {83, 67, 66, 105, 110};
	const char unknown2[] = {2};
	stream substream_strings;
	const char unk44[] = {16};
	stream substream_command_container;
	int i;

	CHECK(stream_read_expect_bytes(s, unknown1));
	CHECK(stream_read_expect_bytes(s, magic));
	CHECK(stream_read_uint32_t(s_root, s, &data->length_this_file, _root));
	CHECK(stream_read_expect_bytes(s, unknown2));
	CHECK(stream_read_uint32_t(s_root, s, &data->size_strings, _root));
	CHECK(stream_read_make_substream(s, &substream_strings, data->size_strings - 4));
	CHECK(stream_read_type_strings(s_root, &substream_strings, &data->strings, _root));
	CHECK(stream_read_uint32_t(s_root, s, &data->count_command_resources, _root));
	data->command_resources = malloc(sizeof(type_resource) * data->count_command_resources);
	for (i = 0; i < data->count_command_resources; i++)
	{
		CHECK(stream_read_type_resource(s_root, s, &data->command_resources[i], _root));
	}
	CHECK(stream_read_expect_bytes(s, unk44));
	CHECK(stream_read_uint32_t(s_root, s, &data->size_command_container, _root));
	CHECK(stream_read_make_substream(s, &substream_command_container, data->size_command_container - 4));
	CHECK(stream_read_type_command_container(s_root, &substream_command_container, &data->command_container, _root));
	CHECK(stream_read_uint16_t(s_root, s, &data->len_unk6, _root));
	CHECK(stream_read_uint32_t(s_root, s, &data->command_ext_pos, _root));
	CHECK(stream_read_type_tree_entry(s_root, s, &data->root_node, _root));
	CHECK(stream_read_type_command_ext2(s_root, s, &data->command_ext, _root));
	return 0;
}

int stream_write_type_uiribbon(stream *s_root, stream *s, type_uiribbon *data, stream_write_stage stage, BOOL do_sequence, type_uiribbon *_root)
{
	const char unknown1[] = {0, 18, 0, 0, 0, 0, 0, 1, 0};
	const char magic[] = {83, 67, 66, 105, 110};
	const char unknown2[] = {2};
	stream substream_strings;
	const char unk44[] = {16};
	stream substream_command_container;
	int i;

	if (stage == STREAM_WRITE_STAGE_WRITE)
	{
		s_root->pos = 0;
	}
	/* No separate sequence run during write */
	if (stage == STREAM_WRITE_STAGE_WRITE && do_sequence) return 0;

	/* Store position for current type */
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->_dryrun_pos = stream_write_get_position_absolute(s);
	}

	CHECK(stream_write_bytes(s, unknown1, sizeof(unknown1), stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, magic, sizeof(magic), stage, do_sequence, _root));
	CHECK(stream_write_uint32_t(s_root, s, &data->length_this_file, stage, do_sequence, _root));
	CHECK(stream_write_bytes(s, unknown2, sizeof(unknown2), stage, do_sequence, _root));
	CHECK(stream_write_uint32_t(s_root, s, &data->size_strings, stage, do_sequence, _root));
	CHECK(stream_write_make_substream(s, &substream_strings));
	CHECK(stream_write_type_strings(s_root, &substream_strings, &data->strings, stage, do_sequence, _root));
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->size_strings = stream_write_get_length(&substream_strings) - (- 4);
	}
	CHECK(stream_write_uint32_t(s_root, s, &data->count_command_resources, stage, do_sequence, _root));
	for (i = 0; i < data->count_command_resources; i++)
	{
		CHECK(stream_write_type_resource(s_root, s, &data->command_resources[i], stage, do_sequence, _root));
	}
	CHECK(stream_write_bytes(s, unk44, sizeof(unk44), stage, do_sequence, _root));
	CHECK(stream_write_uint32_t(s_root, s, &data->size_command_container, stage, do_sequence, _root));
	CHECK(stream_write_make_substream(s, &substream_command_container));
	CHECK(stream_write_type_command_container(s_root, &substream_command_container, &data->command_container, stage, do_sequence, _root));
	if (stage == STREAM_WRITE_STAGE_DRYRUN && do_sequence)
	{
		data->size_command_container = stream_write_get_length(&substream_command_container) - (- 4);
	}
	CHECK(stream_write_uint16_t(s_root, s, &data->len_unk6, stage, do_sequence, _root));
	CHECK(stream_write_uint32_t(s_root, s, &data->command_ext_pos, stage, do_sequence, _root));
	CHECK(stream_write_type_tree_entry(s_root, s, &data->root_node, stage, do_sequence, _root));
	CHECK(stream_write_type_command_ext2(s_root, s, &data->command_ext, stage, do_sequence, _root));
	return 0;
}

void stream_free_type_uiribbon(type_uiribbon *data)
{
	int i;

	stream_free_type_strings(&data->strings);
	for (i = 0; i < data->count_command_resources; i++)
	{
		stream_free_type_resource(&data->command_resources[i]);
	}
	free(data->command_resources);
	stream_free_type_command_container(&data->command_container);
	stream_free_type_tree_entry(&data->root_node);
	stream_free_type_command_ext2(&data->command_ext);
}

int stream_read_uiribbon(stream *s, type_uiribbon *data)
{
	return stream_read_type_uiribbon(s, s, data, data);
}

int stream_write_uiribbon(stream *s, type_uiribbon *data, stream_write_stage stage)
{
	CHECK(stream_write_type_uiribbon(s, s, data, stage, TRUE, data));
	CHECK(stream_write_type_uiribbon(s, s, data, stage, FALSE, data));
	return 0;
}

void stream_free_uiribbon(type_uiribbon *data)
{
	stream_free_type_uiribbon(data);
}
